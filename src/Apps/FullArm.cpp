/**
 **************************************************************************************************
 *
 * @file    : FullArm.cpp
 * @author  : Oussama Darouez
 * @version : 1.0
 * @date    : February 2024
 * @brief   : Full Arm Application Implementation
 * 
 **************************************************************************************************
 */

/*-----------------------------------------------------------------------------------------------*/
/* Includes                                                                                      */
/*-----------------------------------------------------------------------------------------------*/
#include "FullArm.h"

/*-----------------------------------------------------------------------------------------------*/
/* Static members                                                                                */
/*-----------------------------------------------------------------------------------------------*/
BionicArmApp* BionicArmApp::instance = nullptr;

/*-----------------------------------------------------------------------------------------------*/
/* Public methods                                                                                */
/*-----------------------------------------------------------------------------------------------*/
/**************************************************************************************************
  * @brief      Get singleton instance
  * @return     Reference to singleton instance
  ********************************************************************************************** */
BionicArmApp& BionicArmApp::getInstance() {
  if (instance == nullptr) {
    instance = new BionicArmApp();
  }
  return *instance;
}

/**************************************************************************************************
  * @brief      Constructor
  * @return     Nothing
  ********************************************************************************************** */
BionicArmApp::BionicArmApp() : App() {
  uint8_t emgPin = 34;
  uint8_t motorPins[10] = {2,3,4,5,6,7,8,9,10,11};
  uint8_t rowPins[3] = {12,13,14};
  uint8_t colPins[3] = {15,16,17};
  
  bionicArm = new BionicArm(emgPin, motorPins, rowPins, colPins);
}

/**************************************************************************************************
  * @brief      Destructor
  * @return     Nothing
  ********************************************************************************************** */
BionicArmApp::~BionicArmApp() {
  delete bionicArm;
  if (instance == this) {
    instance = nullptr;
  }
}

/*-----------------------------------------------------------------------------------------------*/
/* Protected methods                                                                             */
/*-----------------------------------------------------------------------------------------------*/
/**************************************************************************************************
  * @brief      Start application
  * @return     Nothing
  ********************************************************************************************** */
void BionicArmApp::onStart() {
  bionicArm->setup();
}

/**************************************************************************************************
  * @brief      Main application loop
  * @return     Nothing
  ********************************************************************************************** */
void BionicArmApp::onLoop() {
  bionicArm->doGesture();
} 